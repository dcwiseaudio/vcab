<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WiseReader ì „ì²´ ë“£ê¸°</title>
  <style>
    :root{--brand:#4f8ef7;--bg:#f7f7fb;--card:#fff;--bd:#e9eef5;--tx:#222;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--tx);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}

    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--bd);padding:22px 16px}
    .top{display:flex;flex-direction:column;gap:10px;align-items:center}
    .t1{margin:0;font-size:30px;font-weight:900}
    .t2{font-size:26px;font-weight:900;color:var(--brand);text-align:center}

    main{max-width:900px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--bd);border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center;margin-top:12px}
    button{
      padding:12px 14px;border-radius:12px;border:1px solid #d5ddea;background:#fff;
      font-weight:900;cursor:pointer;min-width:120px
    }
    select{padding:10px 12px;border-radius:10px;border:1px solid #d5ddea;font-weight:900}
    audio{width:100%;margin-top:12px}
    .status{margin-top:10px;font-size:14px;font-weight:800;text-align:center;display:none}
    .bad{color:#c62828}
  </style>
</head>
<body>
<header>
  <div class="top">
    <div class="t1">ì „ì²´ ë“£ê¸°</div>
    <div id="bookLine" class="t2"></div>
  </div>
</header>

<main>
  <div class="card">
    <div class="row" style="margin-top:0">
      <button id="btnLoad">ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button id="btnPlay">ì¬ìƒ</button>
      <button id="btnPause">ì¼ì‹œì •ì§€</button>
      <button id="btnStop">ì •ì§€</button>
    </div>

    <div class="row">
      <span style="font-weight:900;">ì†ë„</span>
      <select id="rate">
       
        <option value="0.9">0.9x</option>
        <option value="1.0" selected>1.0x</option>
        <option value="1.2">1.2x</option>
        <option value="1.5">1.5x</option>
      </select>

      <button id="m2">-2ì´ˆ</button>
      <button id="p2">+2ì´ˆ</button>
      <button id="restart">ì²˜ìŒë¶€í„°</button>
    </div>

    <audio id="player" controls preload="none"></audio>
    <div id="status" class="status bad"></div>

 <div class="row">
    <button onclick="location.href='index.html'">ë‹¨ì–´í•™ìŠµ ì´ˆê¸°ë©”ë‰´</button>

    <a href="https://dcwiseaudio.github.io/wisereader-start/" target="_self"
       style="text-decoration:none; display:inline-block;">
      <button type="button">ì™€ì´ì¦ˆë¦¬ë” ì‹œì‘ í™”ë©´</button>
    </a>
  </div>
    
  </div>
</main>

<script>
  const qn = sessionStorage.getItem('wr_qn') || '';
  const title = sessionStorage.getItem('wr_title') || '';
  if(!qn){ location.href='index.html'; }

  document.getElementById('bookLine').textContent =
    `${qn.toUpperCase()}  |  ${title}`;

  const audio = document.getElementById('player');
  const rateSel = document.getElementById('rate');
  const statusEl = document.getElementById('status');

  function showError(msg){
    statusEl.textContent = msg;
    statusEl.style.display = 'block';
  }
  function clearError(){
    statusEl.textContent = '';
    statusEl.style.display = 'none';
  }
// ğŸŸ¦ ì˜¤ë””ì˜¤ ì €ì¥ì†Œ ë² ì´ìŠ¤ URL (í™•ì •)
const AUDIO_BASE = "https://dcwiseaudio.github.io/audio";

function audioUrl(){
  return `${AUDIO_BASE}/${qn}.mp3?v=${Date.now()}`;
}

  async function load(){
    clearError();
    const url = audioUrl();

    let ok = false;
    try{
      const r = await fetch(url, {method:'HEAD', cache:'no-store'});
      ok = r.ok;
    }catch(_){
      try{
        const r = await fetch(url, {method:'GET', cache:'no-store'});
        ok = r.ok;
      }catch(__){
        ok = false;
      }
    }

    if(!ok){
       showError(`mp3ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${qn}.mp3`);

      return;
    }

    audio.src = url;
    audio.playbackRate = parseFloat(rateSel.value || "1.0");
    audio.load();
    // âœ… â€œë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œâ€ ë¬¸êµ¬ëŠ” ìš”ì²­ëŒ€ë¡œ í‘œì‹œí•˜ì§€ ì•ŠìŒ
  }

  function play(){
    clearError();
    if(!audio.src){ showError("ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ëˆ„ë¥´ì„¸ìš”."); return; }
    audio.playbackRate = parseFloat(rateSel.value || "1.0");
    audio.play().catch(()=>showError("ì¬ìƒì´ ì°¨ë‹¨ë˜ë©´ í™”ë©´ì„ í•œë²ˆ í„°ì¹˜ í›„ ë‹¤ì‹œ ì¬ìƒí•˜ì„¸ìš”."));
  }

  function pause(){ audio.pause(); }
  function stop(){ audio.pause(); audio.currentTime=0; }
  function jump(sec){
    if(!audio.duration) return;
    audio.currentTime = Math.min(Math.max(0, audio.currentTime + sec), audio.duration);
  }

  document.getElementById('btnLoad').addEventListener('click', load);
  document.getElementById('btnPlay').addEventListener('click', play);
  document.getElementById('btnPause').addEventListener('click', pause);
  document.getElementById('btnStop').addEventListener('click', stop);

  rateSel.addEventListener('change', ()=>{
    audio.playbackRate = parseFloat(rateSel.value || "1.0");
  });

  document.getElementById('m2').addEventListener('click', ()=>jump(-2));
  document.getElementById('p2').addEventListener('click', ()=>jump(2));
  document.getElementById('restart').addEventListener('click', ()=>{ audio.currentTime=0; play(); });


  // ì§„ì… ì‹œ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°(ì›í•˜ë©´ ì£¼ì„ì²˜ë¦¬)
  load();
</script>
</body>
</html>


